## 常见问题与解决方案

### 1. Excel 模板中的空列和空单元格在渲染结果中消失

**问题描述**：在 Excel 模板中，如果某个单元格没有内容或样式，渲染时可能会被去除，导致最终文档中缺失该单元格。

**解决方法**：

- **填充背景色**：为目标区域的空单元格填充背景色，确保单元格在渲染过程中保持可见。
- **插入空格**：在空单元格内插入一个空格字符，即使没有实际内容，也能保持单元格的结构。
- **设置边框**：为表格添加边框样式，增强单元格的边界感，避免渲染时单元格消失。

**示例**：

在 Excel 模板中，为所有目标单元格设置浅灰色背景，并在空单元格中插入空格。

### 2. 合并单元格在输出时无效

**问题描述**：在使用循环功能输出表格时，如果模板中存在合并单元格，可能会导致渲染结果异常，如合并效果丢失或数据错位。

**解决方法**：

- **避免使用合并单元格**：尽量避免在循环输出的表格中使用合并单元格，以确保数据的正确渲染。
- **使用跨列居中**：如果需要文本在多个单元格中横向居中，可以使用“跨列居中”功能，而不是合并单元格。
- **限制合并单元格的位置**：若必须使用合并单元格，请仅在表格的上方或右侧进行合并，避免在下方或左侧合并，以防渲染时合并效果丢失。



### 3. 循环渲染区域下方内容导致格式错乱

**问题描述**：在 Excel 模板中，如果在一个会根据数据条目动态增长的循环区域（例如，订单明细）下方，还存在其他内容（例如，订单汇总、备注），那么在渲染时，循环生成的数据行会向下扩展，直接覆盖或推挤下方的静态内容，导致最终文档的格式错乱、内容重叠。

**解决方法**：

  * **调整布局，将循环区域置于底部**：这是最推荐的方法。将需要循环渲染的表格区域放置在整个工作表的底部。将原本位于其下方的汇总、签名等信息全部移动到循环区域的上方。这样，循环数据就可以自由向下扩展，而不会影响任何其他元素。
  * **预留足够的空白行**：如果必须在循环区域下方放置内容，可以预估循环可能生成的最大行数，并在循环区域和下方内容之间手动插入足够多的空白行作为缓冲区。但这种方法存在风险，一旦实际数据超出预估行数，问题会再次出现。
  * **使用 Word 模板**：如果布局要求复杂，无法通过调整 Excel 结构来解决，可以考虑使用 Word 文档作为模板。Word 中的表格在行数增加时，会自动将下方内容向后推移，不会出现内容覆盖的问题，更适合此类动态文档的生成。

**示例**：

**错误的方式**：将“订单汇总”信息紧跟在循环的“订单明细”表格下方。
![20250820080712](https://static-docs.nocobase.com/20250820080712.png)

**正确的方式 1（调整布局）**：将"订单汇总"信息移动到"订单明细"表格的上方，让循环区域成为页面底部的元素。
![20250820082226](https://static-docs.nocobase.com/20250820082226.png)

**正确的方式 2（预留空行）**：在"订单明细"和"订单汇总"之间预留大量空行，确保循环内容有足够的扩展空间。
![20250820081510](https://static-docs.nocobase.com/20250820081510.png)

**正确的方式 3**: 使用word模板。






### 4. 模板渲染时出现错误提示

**问题描述**：在模板渲染过程中，系统弹出错误提示，导致渲染失败。

**可能原因**：

- **占位符错误**：占位符名称与数据集字段不匹配或语法错误。
- **数据缺失**：数据集中缺少模板中引用的字段。
- **格式化器使用不当**：格式化器参数错误或不支持的格式化类型。

**解决方法**：

- **检查占位符**：确保模板中的占位符名称与数据集中的字段名称一致，且语法正确。
- **验证数据集**：确认数据集中包含所有模板中引用的字段，且数据格式符合要求。
- **调整格式化器**：检查格式化器的使用方法，确保参数正确，并使用支持的格式化类型。

**示例**：

**错误模板**：
```
订单编号：{d.orderId}
订单日期：{d.orderDate:format('YYYY/MM/DD')}
总金额：{d.totalAmount:format('0.00')}
```

**数据集**：
```json
{
  "orderId": "A123456789",
  "orderDate": "2025-01-01T10:00:00Z"
  // 缺少 totalAmount 字段
}
```

**解决方法**：在数据集中添加 `totalAmount` 字段，或从模板中移除对 `totalAmount` 的引用。